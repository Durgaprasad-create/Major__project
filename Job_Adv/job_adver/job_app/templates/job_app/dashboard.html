{% extends 'job_app/base.html' %}
{% load static %}
{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Dashboard</h2>

    <div class="card p-4 shadow rounded">
        <!-- Profile Section -->
        <div class="text-center mb-4">
            <img src="{{ user.profile.profile_picture.url|default_if_none:'/static/images/default_profile.png' }}"
                 alt="Profile Picture" class="rounded-circle shadow" width="150" height="150">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="file" name="profile_picture" id="fileInput" style="display:none;" onchange="this.form.submit();">
                <button type="button" class="btn btn-outline-primary mt-3" onclick="document.getElementById('fileInput').click();">
                    Update Profile Picture
                </button>
            </form>
        </div>

        <!-- User Info -->
        <div class="mb-3 d-flex justify-content-between align-items-center">
            <div>
                <h4>{{ user.username }}</h4>
                <p class="text-muted">{{ user.email }}</p>
            </div>
            <div>
                <a href="{% url 'edit_profile' %}" class="btn btn-info">Edit Profile</a>
            </div>
        </div>

        <hr>

        <!-- Dashboard Content -->
        {% if user.profile.user_type == 'employee' %}
            <h5 class="mb-3">Applied Jobs ({{ job_count }})</h5>
            {% if applied_jobs %}
                <ul class="list-group mb-4">
                    {% for application in applied_jobs %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ application.job.JobRole }} at {{ application.job.CompanyName }}
                            <a href="{% url 'job_detail' application.job.id %}" class="btn btn-sm btn-outline-primary">View Details</a>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">You haven't applied to any jobs yet.</p>
            {% endif %}
        
            {% elif user.profile.user_type == 'employer' %}
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5>Posted Jobs ({{ job_count }})</h5>
                <a href="{% url 'post_job' %}" class="btn btn-success">Post New Job</a>
            </div>
        
            {% if posted_jobs %}
                <ul class="list-group mb-4">
                    {% for job in posted_jobs %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                {{ job.JobRole }} at {{ job.CompanyName }}
                            </div>
                            <div class="btn-group">
                                <a href="{% url 'view_applicants' job.id %}" class="btn btn-outline-primary btn-sm">View Applicants</a>
                                <a href="{% url 'delete_job' job.id %}" class="btn btn-sm btn-danger"
                                   onclick="return confirm('Are you sure you want to delete this job?');">Delete</a>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">No jobs posted yet.</p>
            {% endif %}
        {% endif %}
    </div>
</div>
{% endblock %}



    